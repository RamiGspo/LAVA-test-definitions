metadata:
    name: iperf
    format: "Lava-Test Test Definition 1.0"
    description: "iperf is a tool for active measurements of the maximum
                  achievable bandwidth on IP networks."
    maintainer:
        - r.gsponer@kunbus.com
    os:
        - debian
    scope:
        - performance
    environment:
        - lava-test-shell
    devices:
        - Core
        - Core 3
        - core 3+
        - Core S
        - Connect
        - Connect+
        - Connect S
        - Connect SE

params:
    # Set the location of the server.
    # When running in LAVA, it will attempt to discover the server address
    SERVER: "localhost"
    # Time in seconds to transmit for
    TIME: "10"
    # Number of parallel client streams to run
    THREADS: "1"
    # Set affinity of the client to cpu 0 using "-A 0"
    AFFINITY: ""
    # Set REVERSE="-R" to run tx from the server
    REVERSE: ""
    SKIP_INSTALL: "false"

run:
    steps:
        - cd ./automated/linux/ethernet/
        - bash ./iperf.sh -c "${SERVER}" -t "${TIME}" -p "${THREADS}" -s "${SKIP_INSTALL}" "${AFFINITY}" "${REVERSE}"
